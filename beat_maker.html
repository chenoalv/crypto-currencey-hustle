<script>
    const instruments = ['kick', 'snare', 'hihat', 'tom'];
    const grid = document.getElementById('beat-grid');
    const playButton = document.getElementById('play-button');
    const clearButton = document.getElementById('clear-button');
    let isPlaying = false;
    let currentColumn = 0;

    // Audio context
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const sounds = {};

    // Load audio samples
    instruments.forEach(instrument => {
        fetch(`audio/${instrument}.wav`)
            .then(response => response.arrayBuffer())
            .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
            .then(audioBuffer => {
                sounds[instrument] = audioBuffer;
            });
    });

    // Create grid (same as before)
    instruments.forEach(instrument => {
        const row = document.createElement('div');
        row.className = `row-${instrument}`;
        for (let i = 0; i < 8; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.addEventListener('click', () => toggleCell(cell));
            row.appendChild(cell);
        }
        grid.appendChild(row);
    });

    function toggleCell(cell) {
        cell.classList.toggle('active');
    }

    function clearGrid() {
        document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('active'));
    }

    function playBeat() {
        const columns = grid.querySelectorAll(`.cell:nth-child(${currentColumn + 1})`);
        columns.forEach((cell, index) => {
            if (cell.classList.contains('active')) {
                playSound(instruments[index]);
            }
        });
        currentColumn = (currentColumn + 1) % 8;
    }

    function playSound(instrument) {
        if (sounds[instrument]) {
            const source = audioContext.createBufferSource();
            source.buffer = sounds[instrument];
            source.connect(audioContext.destination);
            source.start();
        }
    }

    playButton.addEventListener('click', () => {
        isPlaying = !isPlaying;
        if (isPlaying) {
            audioContext.resume().then(() => {
                playButton.textContent = 'Pause';
                playBeatSequence();
            });
        } else {
            playButton.textContent = 'Play';
        }
    });

    clearButton.addEventListener('click', clearGrid);

    function playBeatSequence() {
        if (!isPlaying) return;
        playBeat();
        setTimeout(playBeatSequence, 250); // Adjust this value to change tempo
    }
</script>
